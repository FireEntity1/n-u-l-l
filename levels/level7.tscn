[gd_scene load_steps=22 format=3 uid="uid://dtrevaib0imo8"]

[ext_resource type="Shader" path="res://shaders/balatro_style_background.gdshader" id="1_0o8ep"]
[ext_resource type="Script" path="res://scripts/bossfight.gd" id="1_lllpe"]
[ext_resource type="PackedScene" uid="uid://bg5bv6bbaw3b1" path="res://components/final_boss_platform.tscn" id="1_yiw31"]
[ext_resource type="Texture2D" uid="uid://c204vlx72ch2o" path="res://sprites/orb.png" id="2_1a4he"]
[ext_resource type="PackedScene" uid="uid://dav5twmuvn8o0" path="res://components/player.tscn" id="2_kosf7"]
[ext_resource type="Shader" path="res://shaders/chrom_abb.gdshader" id="3_4cm2w"]
[ext_resource type="PackedScene" uid="uid://duf8sn5nj8wmu" path="res://components/dialogue_trigger.tscn" id="4_p0rry"]
[ext_resource type="Resource" path="res://dialogic/level7bossintro.dtl" id="7_oheaj"]

[sub_resource type="ShaderMaterial" id="ShaderMaterial_rp4cd"]
shader = ExtResource("1_0o8ep")
shader_parameter/spin_rotation_speed = 2.0
shader_parameter/move_speed = 7.0
shader_parameter/offset = Vector2(0, 0)
shader_parameter/colour_1 = Color(0.03, 0.03, 0.03, 1)
shader_parameter/colour_2 = Color(0, 0, 0, 1)
shader_parameter/colour_3 = Color(0.0126459, 0.0126459, 0.0126459, 1)
shader_parameter/contrast = 3.5
shader_parameter/lighting = 0.4
shader_parameter/spin_amount = 0.25
shader_parameter/pixel_filter = 512.0
shader_parameter/is_rotating = false

[sub_resource type="AtlasTexture" id="AtlasTexture_uo5hr"]
atlas = ExtResource("2_1a4he")
region = Rect2(0, 0, 32, 32)

[sub_resource type="SpriteFrames" id="SpriteFrames_6krk6"]
animations = [{
"frames": [{
"duration": 1.0,
"texture": SubResource("AtlasTexture_uo5hr")
}],
"loop": true,
"name": &"default",
"speed": 5.0
}]

[sub_resource type="Shader" id="Shader_xc274"]
code = "shader_type canvas_item;

uniform sampler2D SCREEN_TEXTURE : hint_screen_texture, filter_linear_mipmap;

uniform int levels = 3;
uniform float spread = 0.01;

vec3 chromatic_slice(float t){
	vec3 res = vec3(1.0-t, 1.0 - abs(t - 1.0), t - 1.0);
	return max(res, 0.0);
}

void fragment(){
	vec3 sum;
	COLOR.rgb = vec3(0);
	vec2 offset = (UV - vec2(0.5))*vec2(1,-1);
	for(int i = 0; i < levels; i++){
		float t = 2.0*float(i)/float(levels-1); // range 0.0->2.0
		vec3 slice = vec3(1.0-t, 1.0 - abs(t - 1.0), t - 1.0);
		slice = max(slice, 0.0);
		sum += slice;
		vec2 slice_offset = (t-1.0)*spread*offset;
		COLOR.rgb += slice * texture(SCREEN_TEXTURE, SCREEN_UV + slice_offset).rgb;
	}
	COLOR.rgb /= sum;
}"

[sub_resource type="ShaderMaterial" id="ShaderMaterial_xdfqd"]
shader = SubResource("Shader_xc274")
shader_parameter/levels = 6
shader_parameter/spread = 0.025

[sub_resource type="ShaderMaterial" id="ShaderMaterial_80jrf"]
shader = ExtResource("3_4cm2w")
shader_parameter/levels = 10
shader_parameter/spread = 0.03

[sub_resource type="AtlasTexture" id="AtlasTexture_3n28a"]
atlas = ExtResource("2_1a4he")
region = Rect2(0, 0, 32, 32)

[sub_resource type="AtlasTexture" id="AtlasTexture_y0sbb"]
atlas = ExtResource("2_1a4he")
region = Rect2(32, 0, 32, 32)

[sub_resource type="AtlasTexture" id="AtlasTexture_1kj4w"]
atlas = ExtResource("2_1a4he")
region = Rect2(64, 0, 32, 32)

[sub_resource type="AtlasTexture" id="AtlasTexture_bi327"]
atlas = ExtResource("2_1a4he")
region = Rect2(96, 0, 32, 32)

[sub_resource type="AtlasTexture" id="AtlasTexture_i3vqp"]
atlas = ExtResource("2_1a4he")
region = Rect2(128, 0, 32, 32)

[sub_resource type="AtlasTexture" id="AtlasTexture_lq07j"]
atlas = ExtResource("2_1a4he")
region = Rect2(160, 0, 32, 32)

[sub_resource type="SpriteFrames" id="SpriteFrames_0s5gc"]
animations = [{
"frames": [{
"duration": 1.0,
"texture": SubResource("AtlasTexture_3n28a")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_y0sbb")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_1kj4w")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_bi327")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_i3vqp")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_lq07j")
}],
"loop": true,
"name": &"default",
"speed": 5.0
}]

[node name="l7" type="Node2D"]
script = ExtResource("1_lllpe")

[node name="bg" type="ColorRect" parent="."]
material = SubResource("ShaderMaterial_rp4cd")
offset_left = -2245.0
offset_top = -1036.0
offset_right = 2831.0
offset_bottom = 2836.0

[node name="FinalBossPlatform" parent="." instance=ExtResource("1_yiw31")]
position = Vector2(285, 1031)

[node name="FinalBossPlatform2" parent="." instance=ExtResource("1_yiw31")]
position = Vector2(-721, 1464)

[node name="FinalBossPlatform3" parent="." instance=ExtResource("1_yiw31")]
position = Vector2(1275, 1455)

[node name="FinalBossPlatform4" parent="." instance=ExtResource("1_yiw31")]
position = Vector2(-90, 1774)

[node name="FinalBossPlatform5" parent="." instance=ExtResource("1_yiw31")]
position = Vector2(644, 1774)

[node name="???" type="AnimatedSprite2D" parent="."]
position = Vector2(292, 1371)
scale = Vector2(7.75, 7.75)
sprite_frames = SubResource("SpriteFrames_6krk6")
autoplay = "default"

[node name="Player" parent="." instance=ExtResource("2_kosf7")]
position = Vector2(279, 931)

[node name="bossCamera" type="Camera2D" parent="."]
position = Vector2(293, 1372)
zoom = Vector2(0.6, 0.6)

[node name="aberration" type="ColorRect" parent="."]
material = SubResource("ShaderMaterial_xdfqd")
offset_left = -2326.0
offset_top = -1172.0
offset_right = 2856.0
offset_bottom = 3036.0

[node name="glitch" type="ColorRect" parent="."]
material = SubResource("ShaderMaterial_xdfqd")
offset_left = -2326.0
offset_top = -1172.0
offset_right = 2856.0
offset_bottom = 3036.0

[node name="entity_aberration" type="AnimatedSprite2D" parent="."]
material = SubResource("ShaderMaterial_80jrf")
position = Vector2(291, 1368)
rotation = -1.56861
scale = Vector2(10.9261, 9.63943)
sprite_frames = SubResource("SpriteFrames_0s5gc")

[node name="DialogueTrigger" parent="." instance=ExtResource("4_p0rry")]
position = Vector2(282, 820)
timeline = ExtResource("7_oheaj")
